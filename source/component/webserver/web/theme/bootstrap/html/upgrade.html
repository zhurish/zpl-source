<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta content="" name="description" />
    <meta content="webthemez" name="author" />
    <!--meta http-equiv="refresh" content="30"-->
    <!-- Bootstrap Styles-->
    <link href="../css/bootstrap.min.css" rel="stylesheet" />

    <!-- private Styles-->
    <link href="../css/private.css" rel="stylesheet" />

    <!-- jQuery Js -->
    <script src="../js/jquery-2.1.1.min.js"></script>
    <!-- Bootstrap Js -->
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/bootstrap-menu.js"></script>
    <script src="../js/xhr.js"></script>
    <script src="../js/data-type.js"></script>

    <title>Upgrade</title>
</head>

<body class="body-bg-img">
    <div id="maincontent" class="container">
        <fieldset class="fieldset-margin fieldset-background">
            <form class="form-horizontal form-margin" role="form" name="upgrade" action="" accept-charset="UTF-8"
                method="POST">
                <legend class="legend-text-align">系统升级</legend>

                <div class="form-group">
                    <label for="clear" class="col-sm-3 control-label">清除配置</label>
                    <div class="checkbox col-sm-4">
                        <input type="checkbox" name="clear" id="clear" checked value="clear">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-xs-4 control-label">
                        <button type="button" class="btn btn-submit" name="upgrade_submit" id="upgrade_submit"
                            onclick="upgrade_onsubmit()"><span class="glyphicon glyphicon-send"
                                style="margin-right:10px;"></span>升级</button>
                    </div>
                </div>
                <div id="upgrade_waiting" class="alert alert-success hiden">
                    <strong><img src="../res/icons/loading.gif" alt="Waiting..."
                            style="padding-left:150px; padding-right:20px">Waiting for system to
                        upgrade and reboot...</strong>
                </div>
                <div id="upgrade_error" class="alert alert-warning hiden">
                    <strong style="padding-left:150px; padding-right:20px; color: red;">Error</strong>
                </div>
                <script type="text/javascript">

                    function upgrade_onsubmit(obj) {
                        var argv;
                        var interval = 120000;
                        var stxhr = new XHR();
                        argv = "button-action=filetbl&button-ID=upgrade";
                        if (document.getElementById("clear").checked)
                            argv += "clear=true";
    
                        $("#upgrade_waiting").css("display", "block");
                        setTimeout(function () { $("#upgrade_waiting").css("display", "none") }, interval);

                        stxhr.post("/action/button_onclick", argv,
                            function (x) {
                                if (x.responseText == "ERROR") {
                                    clearTimeout();
								    $("#upgrade_error").css("display", "block");
								    $("#upgrade_waiting").css("display", "none");
                                    setTimeout(function () { 
                                        $("#upgrade_error").css("display", "none");
                                        load_main_page("filesystem", " #maincontent"); 
                                    }, 3000);
                                    
                                }
                                else if (x.responseText == "OK") {
                                    clearTimeout();
								    $("#upgrade_waiting").css("display", "none");
								    $("#upgrade_error").css("display", "none");
                                    //load_main_page("upgrade", " #maincontent");
                                    //location.replace
                                }
                            },
                            interval
                        );
                    }
                </script>
            </form>
        </fieldset>
    </div>
</body>

</html>